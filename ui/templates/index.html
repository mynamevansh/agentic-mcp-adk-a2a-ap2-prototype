<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agentic System - Observability Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <!--
    DESIGN PHILOSOPHY:
    This UI is intentionally minimal and focused on observability.
    
    WHY NO FANCY FRAMEWORK?
    - Agent system is the star, not the UI
    - Reduces complexity and dependencies
    - Easier to understand and maintain
    - Faster load times
    - Recruiter-friendly (shows restraint and focus)
    
    WHAT THIS UI DOES:
    - Triggers agent execution
    - Displays logs in real-time
    - Shows execution status
    
    WHAT THIS UI DOES NOT DO:
    - Make agent decisions
    - Implement business logic
    - Store data
    - Manage state
    
    This mirrors production agent infrastructure where:
    - Agents run independently (often in containers/serverless)
    - UIs are thin clients for monitoring
    - Observability is separate from orchestration
    -->

    <div class="container">
        <!-- Header -->
        <header>
            <h1>Agentic System Observatory</h1>
            <p class="subtitle">Real-time visualization of MCP + ADK + A2A + AP2 agent execution</p>
        </header>

        <!-- Control Panel -->
        <div class="control-panel">
            <button id="runBtn" class="run-button">
                Run Agent Demo
            </button>
            <div id="status" class="status">Ready</div>
        </div>

        <!-- Execution Info -->
        <div id="executionInfo" class="execution-info" style="display: none;">
            <div class="info-item">
                <span class="label">Execution Time:</span>
                <span id="executionTime">-</span>
            </div>
            <div class="info-item">
                <span class="label">Timestamp:</span>
                <span id="timestamp">-</span>
            </div>
            <div class="info-item">
                <span class="label">Status:</span>
                <span id="executionStatus">-</span>
            </div>
        </div>

        <!-- Log Viewer -->
        <div class="log-container">
            <div class="log-header">
                <h2>Execution Logs</h2>
                <button id="clearBtn" class="clear-button">Clear Logs</button>
            </div>
            <pre id="logOutput" class="log-output">Waiting for execution...</pre>
        </div>

        <!-- Enhanced A2A KYC Demo Section -->
        <div class="demo-section">
            <div class="section-header">
                <h2>Enhanced A2A KYC with Verification State View</h2>
                <p class="section-description">State-based authorization with extended permissions and
                    privacy-preserving
                    verification</p>
            </div>

            <div class="control-panel">
                <button id="runEnhancedBtn" class="run-button">
                    Run Enhanced A2A Demo
                </button>
                <div id="enhancedStatus" class="status">Ready</div>
            </div>

            <div id="enhancedExecutionInfo" class="execution-info" style="display: none;">
                <div class="info-item">
                    <span class="label">Execution Time:</span>
                    <span id="enhancedExecutionTime">-</span>
                </div>
                <div class="info-item">
                    <span class="label">Timestamp:</span>
                    <span id="enhancedTimestamp">-</span>
                </div>
                <div class="info-item">
                    <span class="label">Status:</span>
                    <span id="enhancedExecutionStatus">-</span>
                </div>
            </div>

            <div class="log-container">
                <div class="log-header">
                    <h2>Enhanced Demo Logs</h2>
                    <button id="clearEnhancedBtn" class="clear-button">Clear Logs</button>
                </div>
                <pre id="enhancedLogOutput" class="log-output">Waiting for execution...</pre>
            </div>
        </div>

        <!-- Architecture Info -->
        <div class="info-panel">
            <h3>System Architecture</h3>
            <ul>
                <li><strong>Agent Kai (Planner):</strong> Decomposes goals into execution plans</li>
                <li><strong>Agent Nav (Executor):</strong> Executes tasks using MCP tools</li>
                <li><strong>MCP Server:</strong> Provides standardized tool access</li>
                <li><strong>AP2 Mock:</strong> Simulates secure payment protocol</li>
                <li><strong>A2A Protocol:</strong> Enables agent-to-agent communication</li>
            </ul>
            <p class="note">
                <strong>Note:</strong> This UI is purely for visualization.
                All agent logic runs in <code>demo_flow.py</code> (headless).
                The system can still be executed via CLI: <code>python demo_flow.py</code>
            </p>
        </div>

        <!-- Footer -->
        <footer>
            <p>Agentic MCP-ADK-A2A-AP2 Prototype |
                <a href="https://github.com/mynamevansh/agentic-mcp-adk-a2a-ap2-prototype" target="_blank">GitHub</a>
            </p>
        </footer>
    </div>

    <script>
        /*
         * FRONTEND LOGIC
         * 
         * This script is intentionally simple:
         * 1. Send POST request to /run-demo
         * 2. Display returned logs
         * 3. Update UI status
         * 
         * NO business logic here - just UI updates.
         * The agent system runs on the backend.
         */

        const runBtn = document.getElementById('runBtn');
        const clearBtn = document.getElementById('clearBtn');
        const logOutput = document.getElementById('logOutput');
        const status = document.getElementById('status');
        const executionInfo = document.getElementById('executionInfo');
        const executionTime = document.getElementById('executionTime');
        const timestamp = document.getElementById('timestamp');
        const executionStatus = document.getElementById('executionStatus');

        // Run agent demo
        runBtn.addEventListener('click', async () => {
            // Update UI state
            runBtn.disabled = true;
            runBtn.textContent = 'Running...';
            status.textContent = 'Executing agent system...';
            status.className = 'status running';
            logOutput.textContent = 'Starting agent execution...\n\n';
            executionInfo.style.display = 'none';

            try {
                // Call backend to execute demo_flow.py
                const response = await fetch('/run-demo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                // Display logs
                logOutput.textContent = data.logs || 'No logs available';

                // Update execution info
                if (data.execution_time) {
                    executionTime.textContent = `${data.execution_time.toFixed(2)}s`;
                }
                if (data.timestamp) {
                    timestamp.textContent = new Date(data.timestamp).toLocaleString();
                }

                // Update status based on success
                if (data.success) {
                    status.textContent = 'Execution completed successfully';
                    status.className = 'status success';
                    executionStatus.textContent = 'Success';
                    executionStatus.className = 'status-badge success';
                } else {
                    status.textContent = 'Execution failed';
                    status.className = 'status error';
                    executionStatus.textContent = 'Failed';
                    executionStatus.className = 'status-badge error';
                }

                executionInfo.style.display = 'flex';

            } catch (error) {
                // Handle network or server errors
                logOutput.textContent = `Error: ${error.message}\n\nFailed to connect to backend server.`;
                status.textContent = 'Connection error';
                status.className = 'status error';
            } finally {
                // Re-enable button
                runBtn.disabled = false;
                runBtn.textContent = 'Run Agent Demo';
            }
        });

        // Clear logs
        clearBtn.addEventListener('click', () => {
            logOutput.textContent = 'Waiting for execution...';
            status.textContent = 'Ready';
            status.className = 'status';
            executionInfo.style.display = 'none';
        });

        // Auto-scroll logs to bottom
        const observer = new MutationObserver(() => {
            logOutput.scrollTop = logOutput.scrollHeight;
        });
        observer.observe(logOutput, { childList: true, subtree: true });


        // Enhanced A2A KYC Demo handlers
        const runEnhancedBtn = document.getElementById('runEnhancedBtn');
        const clearEnhancedBtn = document.getElementById('clearEnhancedBtn');
        const enhancedLogOutput = document.getElementById('enhancedLogOutput');
        const enhancedStatus = document.getElementById('enhancedStatus');
        const enhancedExecutionInfo = document.getElementById('enhancedExecutionInfo');
        const enhancedExecutionTime = document.getElementById('enhancedExecutionTime');
        const enhancedTimestamp = document.getElementById('enhancedTimestamp');
        const enhancedExecutionStatus = document.getElementById('enhancedExecutionStatus');

        // Run Enhanced A2A KYC demo
        runEnhancedBtn.addEventListener('click', async () => {
            // Update UI state
            runEnhancedBtn.disabled = true;
            runEnhancedBtn.textContent = 'Running...';
            enhancedStatus.textContent = 'Executing Enhanced A2A demo...';
            enhancedStatus.className = 'status running';
            enhancedLogOutput.textContent = 'Starting Enhanced A2A KYC demo with Verification State View...\n\n';
            enhancedExecutionInfo.style.display = 'none';

            try {
                // Call backend to execute a2a_kyc_enhanced.py
                const response = await fetch('/run-a2a-enhanced', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                // Display logs
                enhancedLogOutput.textContent = data.logs || 'No logs available';

                // Update execution info
                if (data.execution_time) {
                    enhancedExecutionTime.textContent = `${data.execution_time.toFixed(2)}s`;
                }
                if (data.timestamp) {
                    enhancedTimestamp.textContent = new Date(data.timestamp).toLocaleString();
                }

                // Update status based on success
                if (data.success) {
                    enhancedStatus.textContent = 'Execution completed successfully';
                    enhancedStatus.className = 'status success';
                    enhancedExecutionStatus.textContent = 'Success';
                    enhancedExecutionStatus.className = 'status-badge success';
                } else {
                    enhancedStatus.textContent = 'Execution failed';
                    enhancedStatus.className = 'status error';
                    enhancedExecutionStatus.textContent = 'Failed';
                    enhancedExecutionStatus.className = 'status-badge error';
                }

                enhancedExecutionInfo.style.display = 'flex';

            } catch (error) {
                // Handle network or server errors
                enhancedLogOutput.textContent = `Error: ${error.message}\n\nFailed to connect to backend server.`;
                enhancedStatus.textContent = 'Connection error';
                enhancedStatus.className = 'status error';
            } finally {
                // Re-enable button
                runEnhancedBtn.disabled = false;
                runEnhancedBtn.textContent = 'Run Enhanced A2A Demo';
            }
        });

        // Clear Enhanced logs
        clearEnhancedBtn.addEventListener('click', () => {
            enhancedLogOutput.textContent = 'Waiting for execution...';
            enhancedStatus.textContent = 'Ready';
            enhancedStatus.className = 'status';
            enhancedExecutionInfo.style.display = 'none';
        });

        // Auto-scroll Enhanced logs to bottom
        const enhancedObserver = new MutationObserver(() => {
            enhancedLogOutput.scrollTop = enhancedLogOutput.scrollHeight;
        });
        enhancedObserver.observe(enhancedLogOutput, { childList: true, subtree: true });
    </script>
</body>

</html>