<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agentic System - Observability Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <!--
    DESIGN PHILOSOPHY:
    This UI is intentionally minimal and focused on observability.
    
    WHY NO FANCY FRAMEWORK?
    - Agent system is the star, not the UI
    - Reduces complexity and dependencies
    - Easier to understand and maintain
    - Faster load times
    - Recruiter-friendly (shows restraint and focus)
    
    WHAT THIS UI DOES:
    - Triggers agent execution
    - Displays logs in real-time
    - Shows execution status
    
    WHAT THIS UI DOES NOT DO:
    - Make agent decisions
    - Implement business logic
    - Store data
    - Manage state
    
    This mirrors production agent infrastructure where:
    - Agents run independently (often in containers/serverless)
    - UIs are thin clients for monitoring
    - Observability is separate from orchestration
    -->

    <div class="container">
        <!-- Header -->
        <header>
            <h1>Agentic System Observatory</h1>
            <p class="subtitle">Real-time visualization of MCP + ADK + A2A + AP2 agent execution</p>
        </header>

        <!-- Control Panel -->
        <div class="control-panel">
            <button id="runBtn" class="run-button">
                Run Agent Demo
            </button>
            <div id="status" class="status">Ready</div>
        </div>

        <!-- Execution Info -->
        <div id="executionInfo" class="execution-info" style="display: none;">
            <div class="info-item">
                <span class="label">Execution Time:</span>
                <span id="executionTime">-</span>
            </div>
            <div class="info-item">
                <span class="label">Timestamp:</span>
                <span id="timestamp">-</span>
            </div>
            <div class="info-item">
                <span class="label">Status:</span>
                <span id="executionStatus">-</span>
            </div>
        </div>

        <!-- Log Viewer -->
        <div class="log-container">
            <div class="log-header">
                <h2>Execution Logs</h2>
                <button id="clearBtn" class="clear-button">Clear Logs</button>
            </div>
            <pre id="logOutput" class="log-output">Waiting for execution...</pre>
        </div>

        <!-- A2A KYC Demo Section -->
        <div class="demo-section">
            <div class="section-header">
                <h2>A2A KYC Verification Demo</h2>
                <p class="section-description">Agent-to-Agent communication for one-time KYC with reusable credentials
                </p>
            </div>

            <div class="control-panel">
                <button id="runA2ABtn" class="run-button">
                    Run A2A KYC Demo
                </button>
                <div id="a2aStatus" class="status">Ready</div>
            </div>

            <div id="a2aExecutionInfo" class="execution-info" style="display: none;">
                <div class="info-item">
                    <span class="label">Execution Time:</span>
                    <span id="a2aExecutionTime">-</span>
                </div>
                <div class="info-item">
                    <span class="label">Timestamp:</span>
                    <span id="a2aTimestamp">-</span>
                </div>
                <div class="info-item">
                    <span class="label">Status:</span>
                    <span id="a2aExecutionStatus">-</span>
                </div>
            </div>

            <div class="log-container">
                <div class="log-header">
                    <h2>A2A Demo Logs</h2>
                    <button id="clearA2ABtn" class="clear-button">Clear Logs</button>
                </div>
                <pre id="a2aLogOutput" class="log-output">Waiting for execution...</pre>
            </div>
        </div>

        <!-- Architecture Info -->
        <div class="info-panel">
            <h3>System Architecture</h3>
            <ul>
                <li><strong>Agent Kai (Planner):</strong> Decomposes goals into execution plans</li>
                <li><strong>Agent Nav (Executor):</strong> Executes tasks using MCP tools</li>
                <li><strong>MCP Server:</strong> Provides standardized tool access</li>
                <li><strong>AP2 Mock:</strong> Simulates secure payment protocol</li>
                <li><strong>A2A Protocol:</strong> Enables agent-to-agent communication</li>
            </ul>
            <p class="note">
                <strong>Note:</strong> This UI is purely for visualization.
                All agent logic runs in <code>demo_flow.py</code> (headless).
                The system can still be executed via CLI: <code>python demo_flow.py</code>
            </p>
        </div>

        <!-- Footer -->
        <footer>
            <p>Agentic MCP-ADK-A2A-AP2 Prototype |
                <a href="https://github.com/mynamevansh/agentic-mcp-adk-a2a-ap2-prototype" target="_blank">GitHub</a>
            </p>
        </footer>
    </div>

    <script>
        /*
         * FRONTEND LOGIC
         * 
         * This script is intentionally simple:
         * 1. Send POST request to /run-demo
         * 2. Display returned logs
         * 3. Update UI status
         * 
         * NO business logic here - just UI updates.
         * The agent system runs on the backend.
         */

        const runBtn = document.getElementById('runBtn');
        const clearBtn = document.getElementById('clearBtn');
        const logOutput = document.getElementById('logOutput');
        const status = document.getElementById('status');
        const executionInfo = document.getElementById('executionInfo');
        const executionTime = document.getElementById('executionTime');
        const timestamp = document.getElementById('timestamp');
        const executionStatus = document.getElementById('executionStatus');

        // Run agent demo
        runBtn.addEventListener('click', async () => {
            // Update UI state
            runBtn.disabled = true;
            runBtn.textContent = 'Running...';
            status.textContent = 'Executing agent system...';
            status.className = 'status running';
            logOutput.textContent = 'Starting agent execution...\n\n';
            executionInfo.style.display = 'none';

            try {
                // Call backend to execute demo_flow.py
                const response = await fetch('/run-demo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                // Display logs
                logOutput.textContent = data.logs || 'No logs available';

                // Update execution info
                if (data.execution_time) {
                    executionTime.textContent = `${data.execution_time.toFixed(2)}s`;
                }
                if (data.timestamp) {
                    timestamp.textContent = new Date(data.timestamp).toLocaleString();
                }

                // Update status based on success
                if (data.success) {
                    status.textContent = 'Execution completed successfully';
                    status.className = 'status success';
                    executionStatus.textContent = 'Success';
                    executionStatus.className = 'status-badge success';
                } else {
                    status.textContent = 'Execution failed';
                    status.className = 'status error';
                    executionStatus.textContent = 'Failed';
                    executionStatus.className = 'status-badge error';
                }

                executionInfo.style.display = 'flex';

            } catch (error) {
                // Handle network or server errors
                logOutput.textContent = `Error: ${error.message}\n\nFailed to connect to backend server.`;
                status.textContent = 'Connection error';
                status.className = 'status error';
            } finally {
                // Re-enable button
                runBtn.disabled = false;
                runBtn.textContent = 'Run Agent Demo';
            }
        });

        // Clear logs
        clearBtn.addEventListener('click', () => {
            logOutput.textContent = 'Waiting for execution...';
            status.textContent = 'Ready';
            status.className = 'status';
            executionInfo.style.display = 'none';
        });

        // Auto-scroll logs to bottom
        const observer = new MutationObserver(() => {
            logOutput.scrollTop = logOutput.scrollHeight;
        });
        observer.observe(logOutput, { childList: true, subtree: true });

        // A2A KYC Demo handlers
        const runA2ABtn = document.getElementById('runA2ABtn');
        const clearA2ABtn = document.getElementById('clearA2ABtn');
        const a2aLogOutput = document.getElementById('a2aLogOutput');
        const a2aStatus = document.getElementById('a2aStatus');
        const a2aExecutionInfo = document.getElementById('a2aExecutionInfo');
        const a2aExecutionTime = document.getElementById('a2aExecutionTime');
        const a2aTimestamp = document.getElementById('a2aTimestamp');
        const a2aExecutionStatus = document.getElementById('a2aExecutionStatus');

        // Run A2A KYC demo
        runA2ABtn.addEventListener('click', async () => {
            // Update UI state
            runA2ABtn.disabled = true;
            runA2ABtn.textContent = 'Running...';
            a2aStatus.textContent = 'Executing A2A KYC demo...';
            a2aStatus.className = 'status running';
            a2aLogOutput.textContent = 'Starting A2A KYC verification demo...\n\n';
            a2aExecutionInfo.style.display = 'none';

            try {
                // Call backend to execute a2a_kyc_demo.py
                const response = await fetch('/run-a2a-demo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                // Display logs
                a2aLogOutput.textContent = data.logs || 'No logs available';

                // Update execution info
                if (data.execution_time) {
                    a2aExecutionTime.textContent = `${data.execution_time.toFixed(2)}s`;
                }
                if (data.timestamp) {
                    a2aTimestamp.textContent = new Date(data.timestamp).toLocaleString();
                }

                // Update status based on success
                if (data.success) {
                    a2aStatus.textContent = 'Execution completed successfully';
                    a2aStatus.className = 'status success';
                    a2aExecutionStatus.textContent = 'Success';
                    a2aExecutionStatus.className = 'status-badge success';
                } else {
                    a2aStatus.textContent = 'Execution failed';
                    a2aStatus.className = 'status error';
                    a2aExecutionStatus.textContent = 'Failed';
                    a2aExecutionStatus.className = 'status-badge error';
                }

                a2aExecutionInfo.style.display = 'flex';

            } catch (error) {
                // Handle network or server errors
                a2aLogOutput.textContent = `Error: ${error.message}\n\nFailed to connect to backend server.`;
                a2aStatus.textContent = 'Connection error';
                a2aStatus.className = 'status error';
            } finally {
                // Re-enable button
                runA2ABtn.disabled = false;
                runA2ABtn.textContent = 'Run A2A KYC Demo';
            }
        });

        // Clear A2A logs
        clearA2ABtn.addEventListener('click', () => {
            a2aLogOutput.textContent = 'Waiting for execution...';
            a2aStatus.textContent = 'Ready';
            a2aStatus.className = 'status';
            a2aExecutionInfo.style.display = 'none';
        });

        // Auto-scroll A2A logs to bottom
        const a2aObserver = new MutationObserver(() => {
            a2aLogOutput.scrollTop = a2aLogOutput.scrollHeight;
        });
        a2aObserver.observe(a2aLogOutput, { childList: true, subtree: true });
    </script>
</body>

</html>